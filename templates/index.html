{% extends "base.html" %}
{% block content %}

<h1>Découvrez Betty Bot</h1>
<p class="intro">
  Le chatbot métier qui <strong>qualifie vos leads 24/7</strong> avec une <strong>IA spécialisée</strong>.
  Intégration en <strong>2 minutes</strong> sur votre site. Gagnez du temps, ne ratez plus d’opportunités.
</p>

<div class="hero-cta">
  <a href="{{ url_for('config_page') }}" class="btn primary big">Configurer votre bot métier</a>
  <a href="#demo" class="btn">Voir la démo</a>
</div>

<!-- Bandeau de confiance -->
<div class="trust">
  <div>✓ Paiement sécurisé Stripe</div>
  <div>✓ Données traitées en toute confidentialité</div>
  <div>✓ Résiliation possible à tout moment</div>
</div>

<!-- Logos (optionnels) -->
<div class="logos">
  <span class="logos-label">Déjà utilisé par&nbsp;</span>
  <img src="{{ url_for('static', filename='logo-avocat.jpg') }}" onerror="this.style.display='none'">
  <img src="{{ url_for('static', filename='logo-medecin.jpg') }}" onerror="this.style.display='none'">
  <img src="{{ url_for('static', filename='logo-immo.jpg') }}" onerror="this.style.display='none'">
</div>

<!-- Points clés -->
<div class="features">
  <div class="feature">
    <h3>Qualification automatique</h3>
    <p>Nom, email, téléphone, motif… Betty collecte l’essentiel sans friction et vous envoie des prospects prêts à rappeler.</p>
  </div>
  <div class="feature">
    <h3>IA métier</h3>
    <p>Réponses adaptées à votre activité (avocat, médecin, immobilier, notaire), ton personnalisable à votre image.</p>
  </div>
  <div class="feature">
    <h3>Plug &amp; play</h3>
    <p>Un simple script à copier. Couleur, avatar, message d’accueil, coordonnées : tout se règle en quelques clics.</p>
  </div>
</div>

<!-- Bandeau métriques -->
<div class="metrics">
  <div class="metric">
    <div class="m-num">+120</div>
    <div class="m-label">conversations qualifiées / mois</div>
  </div>
  <div class="metric">
    <div class="m-num">-35%</div>
    <div class="m-label">de temps passé au téléphone</div>
  </div>
  <div class="metric">
    <div class="m-num">4,8★</div>
    <div class="m-label">satisfaction moyenne des visiteurs</div>
  </div>
</div>

<!-- Témoignages -->
<div class="testimonials">
  <div class="t-card">
    <div class="t-stars">★★★★★</div>
    <p class="t-quote">“Betty filtre les demandes et prépare nos dossiers. On gagne un temps fou et on rappelle seulement les vrais prospects.”</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-avocat.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">Me Lefèvre</div>
        <div class="t-role">Cabinet d’avocats – Le Mans</div>
      </div>
    </div>
  </div>

  <div class="t-card">
    <div class="t-stars">★★★★★</div>
    <p class="t-quote">“En 2 minutes c’était en ligne. Les patients la trouvent claire, et nous recevons des demandes déjà qualifiées.”</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-medecin.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">Dr Martin</div>
        <div class="t-role">Cabinet médical – Sarthe</div>
      </div>
    </div>
  </div>

  <div class="t-card">
    <div class="t-stars">★★★★☆</div>
    <p class="t-quote">“Leads plus précis, moins d’allers-retours. Les visites s’enchaînent mieux et ça se voit sur le chiffre.”</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-immo.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">R. Dubois</div>
        <div class="t-role">Agence immobilière – Pays de la Loire</div>
      </div>
    </div>
  </div>
</div>

<!-- Badge Trustpilot -->
<div class="trustpilot">
  <a href="#" rel="nofollow noopener">
    <img src="{{ url_for('static', filename='trustpilot-badge.png') }}" alt="Trustpilot" onerror="this.style.display='none'">
    <span>Notes et avis vérifiés sur Trustpilot</span>
  </a>
</div>

<!-- FAQ -->
<section class="faq">
  <h2>FAQ</h2>
  <div class="faq-list">
    <details>
      <summary>Quel est le prix et l’engagement ?</summary>
      <div class="faq-body">
        29,99 € / mois, sans engagement. Vous pouvez résilier à tout moment depuis votre espace (paiement sécurisé Stripe).
      </div>
    </details>
    <details>
      <summary>Comment s’intègre Betty sur mon site ?</summary>
      <div class="faq-body">
        Après paiement, vous obtenez un <strong>script unique</strong> à copier-coller sur votre site (HTML/WordPress/Wix/Webflow…). L’installation prend 2 minutes.
      </div>
    </details>
    <details>
      <summary>Mes données sont-elles protégées ?</summary>
      <div class="faq-body">
        Oui. Les informations sont traitées de manière confidentielle, jamais revendues, et vous restez propriétaire de vos données. Vous pouvez demander leur suppression.
      </div>
    </details>
    <details>
      <summary>Betty donne-t-elle des conseils juridiques/médicaux ?</summary>
      <div class="faq-body">
        Non. Betty <em>informe</em>, <em>oriente</em> et <em>qualifie</em> les demandes. Pour toute décision ou avis formel, elle propose un rendez-vous avec le professionnel.
      </div>
    </details>
  </div>
</section>

<!-- Démo -->
<div id="demo" class="demo-frame" style="margin-top:26px">
  <div class="chat-frame" id="chat" style="display:flex;flex-direction:column;">
    <div style="padding:18px 16px 10px;border-bottom:1px solid var(--border);text-align:center">
      <img id="bot-avatar" src="" alt="Avatar"
           style="width:72px;height:72px;border-radius:999px;border:1px solid var(--border);background:#0b0f14;object-fit:cover;display:block;margin:0 auto 8px">
      <div id="bot-name" style="font-weight:700">Betty</div>
    </div>

    <div id="messages" style="padding:16px;overflow:auto;flex:1;scroll-behavior:smooth">
      <div id="greet" class="bubble"
           style="max-width:280px;background:#111827;border:1px solid var(--border);border-radius:12px;padding:12px;margin:8px 0">
        Bonjour, je suis Betty. Comment puis-je vous aider ?
      </div>
    </div>

    <form id="form" style="padding:14px;border-top:1px solid var(--border);display:flex;gap:8px">
      <input id="input" type="text" placeholder="Écrivez et appuyez sur Entrée…" autocomplete="off" autofocus
             style="background:#0b0f14;border:1px solid var(--border);border-radius:10px;color:var(--text);padding:12px;flex:1">
      <button class="btn" type="submit">Envoyer</button>
    </form>
  </div>
</div>

<div class="hero-cta" style="margin-top:24px">
  <a href="{{ url_for('config_page') }}" class="btn primary big">Je crée mon bot maintenant</a>
</div>

<script>
  const botId = new URLSearchParams(location.search).get('bot_id') || 'avocat-001';

  const avatarEl = document.getElementById('bot-avatar');
  const nameEl   = document.getElementById('bot-name');
  const greetEl  = document.getElementById('greet');
  const msgs     = document.getElementById('messages');
  const form     = document.getElementById('form');
  const input    = document.getElementById('input');

  // Focus intelligent : taper n'importe où = focus sur l'input
  document.addEventListener('keydown', (e) => {
    const ign = ['Enter','Escape','Tab'];
    if (ign.includes(e.key)) return;
    if (document.activeElement !== input) {
      input.focus();
      if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
        e.preventDefault();
        input.value += e.key;
      }
    }
  });

  function scrollToBottom(){ msgs.scrollTop = msgs.scrollHeight; }

  // Meta bot
  fetch(`/api/bot_meta?bot_id=${encodeURIComponent(botId)}`)
    .then(r => r.json())
    .then(meta => {
      nameEl.textContent = meta.name || 'Betty';
      avatarEl.src = meta.avatar_url || '';
      if (meta.greeting) greetEl.textContent = meta.greeting;
      document.documentElement.style.setProperty('--primary', meta.color_hex || '#4F46E5');
      scrollToBottom();
    }).catch(()=>{});

  // Bulle
  function addBubble(text, mine=false){
    const div = document.createElement('div');
    div.className = 'bubble';
    div.style.maxWidth = '280px';
    div.style.border = '1px solid var(--border)';
    div.style.borderRadius = '12px';
    div.style.padding = '12px';
    div.style.margin = '8px 0';
    div.style.whiteSpace = 'pre-wrap';
    div.textContent = text;
    if(mine){ div.style.background='#1b2230'; div.style.marginLeft='auto'; }
    else    { div.style.background='#111827'; div.style.marginRight='auto'; }
    msgs.appendChild(div);
    scrollToBottom();
    return div;
  }

  // Loader "Betty écrit…"
  function showTyping(){
    const t = document.createElement('div');
    t.className = 'bubble typing';
    t.style.maxWidth = '280px';
    t.style.border = '1px solid var(--border)';
    t.style.borderRadius = '12px';
    t.style.padding = '12px';
    t.style.margin = '8px 0';
    t.style.background = '#111827';
    t.style.marginRight = 'auto';
    t.innerHTML = '<span class="label">Betty écrit</span><span class="dots"><i></i><i></i><i></i></span>';
    msgs.appendChild(t);
    scrollToBottom();
    return t;
  }
  function hideTyping(el){ if(el && el.parentNode) el.parentNode.removeChild(el); }

  // Submit
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const text = input.value.trim();
    if(!text) return;
    addBubble(text, true);
    input.value = '';

    const typing = showTyping();
    try {
      const r = await fetch('/api/bettybot', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message: text, bot_id: botId })
      });
      const j = await r.json();
      hideTyping(typing);
      addBubble(j.response || "Désolé, une erreur est survenue.");
    } catch {
      hideTyping(typing);
      addBubble("Désolé, une erreur est survenue.");
    }
  });

  window.addEventListener('load', ()=>{ input.focus(); scrollToBottom(); });
</script>

{% endblock %}
