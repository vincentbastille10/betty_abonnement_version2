{% extends "base.html" %}
{% block content %}

{# Masque le titre "‚ú® Betty Bots" qui vient √©ventuellement du layout de base #}
<style>
  header h1:first-child {
    display: none;
  }
</style>

<!-- Bandeau logos Spectra Media + Betty Bots (version large) -->
<div style="display:flex;justify-content:center;align-items:center;gap:40px;margin:24px 0 8px;">
  <img src="{{ url_for('static', filename='spectra_media_logo.png') }}"
       alt="Spectra Media"
       style="height:120px;object-fit:contain;">
  <img src="{{ url_for('static', filename='logo-bettybots.png') }}"
       alt="Betty Bots"
       style="height:120px;object-fit:contain;">
</div>

<h1>D√©couvrez Betty Bots</h1>
<p class="intro">
  Le chatbot m√©tier intelligent nouvelle g√©n√©ration qui <strong>r√©cup√®re vos clients 24/7</strong> avec une <strong>IA sp√©cialis√©e</strong>.
  Int√©gration en <strong>2 minutes</strong> sur votre site. Gagnez du temps, ne ratez plus d‚Äôopportunit√©s.
</p>

<!-- Bloc CTA : colonne centr√©e -->
<div class="hero-cta"
     style="display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:4px;">

  <p class="trial-note" style="max-width:520px;margin:0;text-align:center;font-size:15px;opacity:.88;">
    Aucun risque : testez Betty pendant <strong>7 jours gratuitement</strong>, puis d√©cidez si vous souhaitez continuer.
  </p>

  <!-- Bouton essai gratuit 7 jours -> va vers la page de configuration -->
  <a href="{{ url_for('config_page') }}"
     class="btn primary big"
     style="display:inline-block;margin:0 auto;">
    Essayer Betty 7 jours gratuitement
  </a>

</div>

<!-- Bandeau de confiance -->
<div class="trust">
  <div>‚úì Paiement s√©curis√© Stripe</div>
  <div>‚úì Donn√©es trait√©es en toute confidentialit√©</div>
  <div>‚úì R√©siliation possible √† tout moment</div>
</div>

<!-- Points cl√©s -->
<div class="features">
  <div class="feature">
    <h3>Qualification automatique</h3>
    <p>Nom, email, t√©l√©phone, motif‚Ä¶ Betty collecte l‚Äôessentiel sans friction et vous envoie des prospects pr√™ts √† rappeler.</p>
  </div>
  <div class="feature">
    <h3>IA m√©tier</h3>
    <p>R√©ponses adapt√©es √† votre activit√© (avocat, m√©decin, immobilier, notaire, artisan, etc...), ton personnalisable √† votre image.</p>
  </div>
  <div class="feature">
    <h3>Plug &amp; play</h3>
    <p>Un simple script √† copier. Couleur, avatar, message d‚Äôaccueil, coordonn√©es : tout se r√®gle en quelques clics.</p>
  </div>
</div>

<!-- Bandeau m√©triques -->
<div class="metrics">
  <div class="metric">
    <div class="m-num">+120</div>
    <div class="m-label">conversations qualifi√©es / mois</div>
  </div>
  <div class="metric">
    <div class="m-num">-35%</div>
    <div class="m-label">de temps pass√© au t√©l√©phone</div>
  </div>
  <div class="metric">
    <div class="m-num">4,8‚òÖ</div>
    <div class="m-label">satisfaction moyenne des visiteurs</div>
  </div>
</div>

<!-- T√©moignages -->
<div class="testimonials">
  <div class="t-card">
    <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    <p class="t-quote">‚ÄúBetty filtre les demandes et pr√©pare nos dossiers. On gagne un temps fou et on rappelle seulement les vrais prospects.‚Äù</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-avocat.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">Me Lef√®vre</div>
        <div class="t-role">Cabinet d‚Äôavocats ‚Äì Le Mans</div>
      </div>
    </div>
  </div>

  <div class="t-card">
    <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    <p class="t-quote">‚ÄúEn 2 minutes c‚Äô√©tait en ligne. Les patients la trouvent claire, et nous recevons des demandes d√©j√† qualifi√©es.‚Äù</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-medecin.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">Dr Martin</div>
        <div class="t-role">Cabinet m√©dical ‚Äì Sarthe</div>
      </div>
    </div>
  </div>

  <div class="t-card">
    <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
    <p class="t-quote">‚ÄúLeads plus pr√©cis, moins d‚Äôallers-retours. Les visites s‚Äôencha√Ænent mieux et √ßa se voit sur le chiffre.‚Äù</p>
    <div class="t-author">
      <img src="{{ url_for('static', filename='logo-immo.jpg') }}" onerror="this.style.display='none'">
      <div>
        <div class="t-name">R. Dubois</div>
        <div class="t-role">Agence immobili√®re ‚Äì Pays de la Loire</div>
      </div>
    </div>
  </div>
</div>

<!-- Badge Trustpilot -->
<div class="trustpilot">
  <a href="#" rel="nofollow noopener">
    <img src="{{ url_for('static', filename='trustpilot-badge.png') }}" alt="Trustpilot" onerror="this.style.display='none'">
    <span>Notes et avis v√©rifi√©s sur Trustpilot</span>
  </a>
</div>

<!-- FAQ -->
<section class="faq">
  <h2>FAQ</h2>
  <div class="faq-list">
    <details>
      <summary>Quel est le prix et l‚Äôengagement ?</summary>
      <div class="faq-body">
        29,99 ‚Ç¨ / mois, sans engagement. Vous pouvez r√©silier √† tout moment depuis votre espace (paiement s√©curis√© Stripe).
      </div>
    </details>
    <details>
      <summary>Comment s‚Äôint√®gre Betty sur mon site ?</summary>
      <div class="faq-body">
        Apr√®s paiement, vous obtenez un <strong>script unique</strong> √† copier-coller sur votre site (HTML/WordPress/Wix/Webflow‚Ä¶). L‚Äôinstallation prend 2 minutes.
      </div>
    </details>
    <details>
      <summary>Mes donn√©es sont-elles prot√©g√©es ?</summary>
      <div class="faq-body">
        Oui. Les informations sont trait√©es de mani√®re confidentielle, jamais revendues, et vous restez propri√©taire de vos donn√©es. Vous pouvez demander leur suppression.
      </div>
    </details>
    <details>
      <summary>Betty donne-t-elle des conseils juridiques/m√©dicaux ?</summary>
      <div class="faq-body">
        Non. Betty <em>informe</em>, <em>oriente</em> et <em>qualifie</em> les demandes. Pour toute d√©cision ou avis formel, elle propose un rendez-vous avec le professionnel.
      </div>
    </details>
  </div>
</section>

<!-- D√©mo -->
<div id="demo" class="demo-frame" style="margin-top:26px">
  <div class="chat-frame" id="chat" style="display:flex;flex-direction:column;">
    <div style="padding:18px 16px 10px;border-bottom:1px solid var(--border);text-align:center">
      <img id="bot-avatar" src="" alt="Avatar"
           style="width:72px;height:72px;border-radius:999px;border:1px solid var(--border);background:#0b0f14;object-fit:cover;display:block;margin:0 auto 8px">
      <div id="bot-name" style="font-weight:700">Betty Bot (Spectra Media)</div>
    </div>

    <div id="messages" style="padding:16px;overflow:auto;flex:1;scroll-behavior:smooth">
      <div id="greet" class="bubble"
           style="max-width:280px;background:#111827;border:1px solid var(--border);border-radius:12px;padding:12px;margin:8px 0">
        Bonjour, je suis Betty. Comment puis-je vous aider ?
      </div>
    </div>

    <form id="form" style="padding:14px;border-top:1px solid var(--border);display:flex;gap:8px">
      <input id="input" type="text" placeholder="√âcrivez et appuyez sur Entr√©e‚Ä¶" autocomplete="off"
             style="background:#0b0f14;border:1px solid var(--border);border-radius:10px;color:var(--text);padding:12px;flex:1">
      <button class="btn" type="submit">Envoyer</button>
    </form>
  </div>
</div>
<p class="trial-note" style="max-width:520px;margin:0 auto 12px;text-align:center;font-size:15px;opacity:.88;">
  Profitez de <strong>7 jours d‚Äôessai gratuit</strong> avant de vous engager.
</p>

<div class="hero-cta" style="margin-top:24px;text-align:center;">
  <a href="{{ url_for('config_page') }}"
     class="btn primary big"
     style="display:inline-block;margin:0 auto;">Je cr√©e mon bot maintenant</a>
</div>
<div style="text-align:center;font-size:13px;opacity:.7;margin-top:4px;">
  Paiement s√©curis√© Stripe ‚Ä¢ Sans engagement ‚Ä¢ Annulable en 1 clic
</div>
<div style="margin-top:40px;padding:20px 0;text-align:center;font-size:13px;opacity:.75;">
  <a href="mailto:spectramediabots@gmail.com"
     style="color:#8ab4ff;text-decoration:none;">
    üì© Contact ‚Äî Spectra Media AI
  </a>
</div>

<script>
  const botId = new URLSearchParams(location.search).get('bot_id') || 'spectra-demo';

  const avatarEl = document.getElementById('bot-avatar');
  const nameEl   = document.getElementById('bot-name');
  const greetEl  = document.getElementById('greet');
  const msgs     = document.getElementById('messages');
  const form     = document.getElementById('form');
  const input    = document.getElementById('input');

  // Focus intelligent : taper n'importe o√π = focus sur l'input (sans autofocus initial)
  document.addEventListener('keydown', (e) => {
    const ign = ['Enter','Escape','Tab'];
    if (ign.includes(e.key)) return;
    if (document.activeElement !== input) {
      input.focus();
      if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
        e.preventDefault();
        input.value += e.key;
      }
    }
  });

  function scrollToBottom(){ msgs.scrollTop = msgs.scrollHeight; }

  // Meta bot
  fetch(`/api/bot_meta?bot_id=${encodeURIComponent(botId)}`)
    .then(r => r.json())
    .then(meta => {
      nameEl.textContent = meta.name || 'Betty';
      avatarEl.src = meta.avatar_url || '';
      if (meta.greeting) greetEl.textContent = meta.greeting;
      document.documentElement.style.setProperty('--primary', meta.color_hex || '#4F46E5');
      scrollToBottom();
    }).catch(()=>{});

  // Bulle
  function addBubble(text, mine=false){
    const div = document.createElement('div');
    div.className = 'bubble';
    div.style.maxWidth = '280px';
    div.style.border = '1px solid var(--border)';
    div.style.borderRadius = '12px';
    div.style.padding = '12px';
    div.style.margin = '8px 0';
    div.style.whiteSpace = 'pre-wrap';
    div.textContent = text;
    if(mine){ div.style.background='#1b2230'; div.style.marginLeft='auto'; }
    else    { div.style.background='#111827'; div.style.marginRight='auto'; }
    msgs.appendChild(div);
    scrollToBottom();
    return div;
  }

  // Loader "Betty √©crit‚Ä¶"
  function showTyping(){
    const t = document.createElement('div');
    t.className = 'bubble typing';
    t.style.maxWidth = '280px';
    t.style.border = '1px solid var(--border)';
    t.style.borderRadius = '12px';
    t.style.padding = '12px';
    t.style.margin = '8px 0';
    t.style.background = '#111827';
    t.style.marginRight = 'auto';
    t.innerHTML = '<span class="label">Betty √©crit</span><span class="dots"><i></i><i></i><i></i></span>';
    msgs.appendChild(t);
    scrollToBottom();
    return t;
  }
  function hideTyping(el){ if(el && el.parentNode) el.parentNode.removeChild(el); }

  // Submit
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const text = input.value.trim();
    if(!text) return;
    addBubble(text, true);
    input.value = '';

    const typing = showTyping();
    try {
      const r = await fetch('/api/bettybot', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message: text, bot_id: botId })
      });
      const j = await r.json();
      // Nettoyage robuste du tag technique (avec ou sans </LEAD_JSON>)
      const cleaned = String(j.response ?? "")
        .replace(/\s*<LEAD_JSON>[\s\S]*?(?:<\/LEAD_JSON>|$)/g, "")
        .replace(/```[\s\S]*?```/g, "")
        .trim();

      addBubble(cleaned || "D√©sol√©, une erreur est survenue.");
      hideTyping(typing);

    } catch {
      hideTyping(typing);
      addBubble("D√©sol√©, une erreur est survenue.");
    }
  });
</script>
{% endblock %}




