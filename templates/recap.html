<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>R√©capitulatif ‚Äî Betty Abonnement</title>

  <!-- Fallbacks pour √©viter les 404 manifest/ic√¥nes si pas encore fournis -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <style>
    :root{
      --bg:#0b0d12;
      --ink:#f5f7fb;
      --muted:#a6b0c2;
      --line:#1f2a3a;
      --panel:#0f1420;
      --card:#0d121c;
      --surface:#111826;
      --brand: {{ (cfg.color or '#4F46E5')|e }};
      --ok:#10b981;
      --warn:#f59e0b;
      --err:#ef4444;
      --shadow: 0 8px 28px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #0b0d12 0%, #0a0f19 60%, #0b0d12 100%);
      color:var(--ink); font:16px/1.6 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap{max-width:1100px; margin:32px auto; padding:0 16px 48px}
    header.top{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin:0 0 18px 0;
    }
    .logo{
      display:flex; align-items:center; gap:12px;
      font-weight:800; letter-spacing:.3px; color:var(--ink);
    }
    .logo-badge{
      width:36px; height:36px; border-radius:10px; background:var(--brand);
      box-shadow:0 6px 18px rgba(79,70,229,.35);
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      border:1px solid var(--line); padding:6px 10px; border-radius:999px; color:var(--muted);
      background:linear-gradient(180deg, #0c1120 0%, #0b0f1b 100%); text-decoration:none;
    }
    .grid{
      display:grid; gap:16px; grid-template-columns: 1.2fr .8fr;
    }
    @media (max-width: 920px){ .grid{grid-template-columns: 1fr;} }

    .card{
      background:var(--surface); border:1px solid var(--line); border-radius:var(--radius); padding:20px;
      box-shadow: var(--shadow);
    }
    .headline{margin:0 0 8px 0; font-size:22px; font-weight:800}
    .sub{margin:0 0 16px 0; color:var(--muted)}
    .kv{display:grid; gap:12px; grid-template-columns: 160px 1fr;}
    .kv .k{color:#dbe2ef; font-weight:600}
    .kv .v{color:#c9d3e6}
    .avatar{
      width:140px; height:140px; border-radius:14px; object-fit:cover;
      border:3px solid var(--brand); background:#0b0f18;
      box-shadow:0 10px 26px rgba(79,70,229,.25);
    }
    .info-list{display:grid; gap:10px}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .badge{display:inline-block; padding:4px 10px; border-radius:999px; background:#0f172a; border:1px solid #1d2735; color:#cfe3ff}
    .cta{display:flex; gap:12px; flex-wrap:wrap; margin-top:10px}
    .btn{
      appearance:none; border:none; cursor:pointer; text-decoration:none;
      background:var(--brand); color:#fff; padding:12px 16px; border-radius:12px; font-weight:700;
      box-shadow:0 8px 18px rgba(79,70,229,.35);
    }
    .btn.secondary{
      background:transparent; border:1px solid #263142; color:#d8e1f0;
    }
    .btn.ghost{
      background:#0f1420; border:1px dashed #28354a; color:#bcd0f2;
    }

    details.grp{border:1px solid var(--line); border-radius:12px; overflow:hidden}
    details.grp + details.grp{margin-top:12px}
    details.grp > summary{
      list-style:none; background:var(--panel); padding:14px 16px; cursor:pointer; font-weight:700;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    details.grp > summary::-webkit-details-marker{display:none}
    .chev{width:10px;height:10px;border-right:2px solid #7e8aa6;border-bottom:2px solid #7e8aa6;transform:rotate(-45deg);transition:.25s}
    details[open] .chev{transform:rotate(45deg)}
    .sub-panel{padding:16px; background:linear-gradient(180deg,#0c111b 0%, #0a0f19 100%); border-top:1px solid var(--line)}
    .two{display:grid; gap:12px; grid-template-columns:1fr 1fr}
    @media (max-width: 760px){ .two{grid-template-columns:1fr} }

    .hint{font-size:13px; color:#93a3bf}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    pre.json{margin:0; padding:14px; border-radius:12px; background:#0a0f19; color:#d7e7ff; border:1px solid #1b2736; overflow:auto}
    code.inline{background:#0c1322; padding:2px 6px; border-radius:6px; border:1px solid #1c283a}

    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .divider{height:1px; border:none; border-top:1px dashed #243148; margin:16px 0}
    footer{margin-top:28px; display:flex; justify-content:space-between; gap:12px; color:#8fa3c6; font-size:13px}
    .r{text-align:right}
  </style>
</head>
<body>
  <div class="wrap">

    <header class="top">
      <div class="logo">
        <div class="logo-badge" aria-hidden="true"></div>
        <div>Betty ‚Äî <span style="opacity:.85">Abonnement</span></div>
      </div>
      <nav class="row">
        <a class="pill" href="/inscription">Modifier</a>
        <a class="pill" href="/config">Config</a>
        <a class="pill" href="/pay">Paiement</a>
      </nav>
    </header>

    <!-- Bandeau d‚Äô√©tat -->
    <div class="card" style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:10px;height:10px;border-radius:50%;background:var(--ok);box-shadow:0 0 0 4px rgba(16,185,129,.18)"></div>
      <div style="font-weight:700">R√©capitulatif pr√™t</div>
      <div class="hint">Inutile d‚Äô√™tre parfait : vous pouvez encore modifier avant paiement.</div>
    </div>

    <div class="grid">
      <!-- Colonne gauche : r√©cap -->
      <section class="card">
        <h2 class="headline">R√©capitulatif</h2>
        <p class="sub">V√©rifiez le pack, l‚Äôidentit√© visuelle et le message d‚Äôaccueil. Ajustez si n√©cessaire.</p>

        <div class="kv" style="margin-bottom:14px">
          <div>
            <img
              class="avatar"
              alt="avatar"
              src="{{ (cfg.avatar_url or '/avatar/agent_immo') | e }}"
              onerror="this.src='/avatar/agent_immo'; this.style.opacity='.95'">
          </div>
          <div class="info-list">
            <div><span class="k">Pack</span> ‚Äî <span class="badge">{{ (cfg.pack or 'agent_immobilier') | e }}</span></div>
            <div><span class="k">Couleur</span> ‚Äî <span class="badge">{{ (cfg.color or '#4F46E5') | e }}</span></div>
            <div><span class="k">Contact</span> ‚Äî <span>{{ (cfg.contact or '‚Äî') | e }}</span></div>
            <div><span class="k">Greeting</span> ‚Äî <span>{{ (cfg.greeting or 'Bonjour, je suis Betty. Comment puis-je vous aider ?') | e }}</span></div>
            <div><span class="k">Position</span> ‚Äî <span>px={{ (cfg.px or '0.5') | e }}, py={{ (cfg.py or '0.5') | e }}</span></div>
          </div>
        </div>

        <div class="cta">
          <a class="btn" href="/pay">Proc√©der au paiement</a>
          <a class="btn secondary" href="/inscription">Modifier</a>
          <a class="btn ghost" href="/preview?pack={{ (cfg.pack or 'agent_immobilier')|e }}">Pr√©visualiser</a>
        </div>

        <hr class="divider">

        <details class="grp">
          <summary>
            üì¶ Contenu du pack s√©lectionn√©
            <span class="chev"></span>
          </summary>
          <div class="sub-panel two">
            <div>
              <h3 style="margin:0 0 6px">Fonctionnalit√©s incluses</h3>
              <ul style="margin:0 0 8px 18px">
                <li>Assistant web int√©gr√© (script embed, 1 domaine autoris√©)</li>
                <li>Qualification de leads + envoi email r√©sum√©</li>
                <li>Dashboard de configuration rapide</li>
                <li>Personnalisation avatar / teinte / message d‚Äôaccueil</li>
              </ul>
              <p class="hint">Besoin multi-domaines / CRM / RGPD avanc√© ? Voir l‚Äôoffre Pro.</p>
            </div>
            <div>
              <h3 style="margin:0 0 6px">Sp√©cificit√©s du m√©tier</h3>
              <ul style="margin:0 0 8px 18px">
                <li>Scripts conversationnels adapt√©s : <b>{{ (cfg.pack or 'agent_immobilier') | e }}</b></li>
                <li>Templates d‚Äôemails d√©di√©s</li>
                <li>Captation de donn√©es conforme (consentement explicite)</li>
              </ul>
              <p class="hint">Les contenus sont √©ditables depuis le tableau de bord.</p>
            </div>
          </div>
        </details>

        <details class="grp" style="margin-top:12px">
          <summary>
            üß© Int√©gration & aper√ßu
            <span class="chev"></span>
          </summary>
          <div class="sub-panel">
            <p class="hint" style="margin:0 0 10px">Votre widget peut √™tre pr√©visualis√© avant paiement.</p>
            <div class="two">
              <div>
                <h4 style="margin:0 0 6px">Lien d‚Äôaper√ßu (exemple)</h4>
                <div class="mono" style="font-size:13px;word-break:break-all">
                  /preview?pack={{ (cfg.pack or 'agent_immobilier')|e }}&color={{ (cfg.color or '#4F46E5')|e }}
                </div>
                <p class="hint" style="margin:6px 0 0">* Le lien exact peut diff√©rer selon votre d√©ploiement.</p>
              </div>
              <div>
                <h4 style="margin:0 0 6px">Snippet d‚Äôint√©gration (exemple)</h4>
                <pre class="json mono">&lt;script src="https://cdn.spectramedia.ai/betty/embed.js"
  data-pack="{{ (cfg.pack or 'agent_immobilier')|e }}"
  data-color="{{ (cfg.color or '#4F46E5')|e }}"
  data-greeting="{{ (cfg.greeting or 'Bonjour, je suis Betty.')|e }}"&gt;&lt;/script&gt;</pre>
              </div>
            </div>
          </div>
        </details>

        <details class="grp" style="margin-top:12px">
          <summary>
            üß™ D√©tails techniques
            <span class="chev"></span>
          </summary>
          <div class="sub-panel">
            <p class="hint">Ces valeurs sont lues depuis la session ou la querystring en fallback.</p>
            <pre class="json mono">{{ cfg | tojson(indent=2) }}</pre>
          </div>
        </details>

        <details class="grp" style="margin-top:12px">
          <summary>
            üõ†Ô∏è D√©pannage rapide (si une ressource manque)
            <span class="chev"></span>
          </summary>
          <div class="sub-panel">
            <ul style="margin:0 0 8px 18px">
              <li>Si l‚Äôavatar ne s‚Äôaffiche pas, un <code class="inline">onerror</code> bascule vers <code class="inline">/avatar/agent_immo</code>.</li>
              <li>Si des images <code class="inline">/static/*.jpg</code> sont absentes, renommez-les exactement comme appel√©es (Linux est sensible √† la casse).</li>
              <li>Si <code class="inline">/favicon-*.png</code> ou <code class="inline">/site.webmanifest</code> manquent, cr√©ez des placeholders (ou exposez des routes d√©di√©es).</li>
              <li>Ne jamais utiliser <code class="inline">cfg['cl√©']</code> dans Jinja ‚Üí pr√©f√©rez <code class="inline">{{'{{ (cfg.cle or \\\"-\\\") }}'}}</code>.</li>
            </ul>
            <p class="hint">Les 404 d‚Äôassets n‚Äôentra√Ænent pas un 500, mais nettoyez-les pour des logs propres.</p>
          </div>
        </details>
      </section>

      <!-- Colonne droite : paiement / conformit√© / notes -->
      <aside class="card">
        <h2 class="headline">Prochaine √©tape</h2>
        <p class="sub">Validez le paiement pour activer le bot et recevoir le snippet final.</p>

        <div class="row" style="margin-bottom:10px">
          <a class="btn" href="/pay">Payer maintenant</a>
          <a class="btn secondary" href="/inscription">Revenir</a>
        </div>

        <hr class="divider">

        <details class="grp">
          <summary>
            üîê Conformit√© & donn√©es
            <span class="chev"></span>
          </summary>
          <div class="sub-panel">
            <ul style="margin:0 0 8px 18px">
              <li>Consentement explicite pour la collecte (opt-in clair)</li>
              <li>Suppression sur demande et tra√ßabilit√©</li>
              <li>Export des donn√©es (CSV/JSON) sur demande</li>
              <li>Stockage UE par d√©faut (selon plan)</li>
            </ul>
            <p class="hint">Des options avanc√©es RGPD et DPA sont disponibles sur l‚Äôoffre Pro.</p>
          </div>
        </details>

        <details class="grp" style="margin-top:12px">
          <summary>
            üßæ Facturation
            <span class="chev"></span>
          </summary>
          <div class="sub-panel">
            <div class="two">
              <div>
                <div class="k">Plan</div>
                <div class="badge">Standard ‚Äî 29,99 ‚Ç¨/mois</div>
              </div>
              <div>
                <div class="k">Essai</div>
                <div>Pr√©visualisation gratuite incluse</div>
              </div>
              <div>
                <div class="k">Renouvellement</div>
                <div>Mensuel, sans engagement</div>
              </div>
              <div>
                <div class="k">Annulation</div>
                <div>√Ä tout moment avant l‚Äô√©ch√©ance</div>
              </div>
            </div>
          </div>
        </details>

        <details class="grp" style="margin-top:12px">
          <summary>
            üìù Notes internes
            <span class="chev"></span>
          </summary>
          <div class="sub-panel">
            <p class="hint">Ces notes ne sont pas visibles par vos visiteurs.</p>
            <ul style="margin:0 0 8px 18px">
              <li>Pack : <b>{{ (cfg.pack or 'agent_immobilier') | e }}</b></li>
              <li>Couleur : <span style="color:var(--brand)">{{ (cfg.color or '#4F46E5') | e }}</span></li>
              <li>Contact : {{ (cfg.contact or '‚Äî') | e }}</li>
              <li>Greet : {{ (cfg.greeting or 'Bonjour, je suis Betty.') | e }}</li>
              <li>Avatar URL : <span class="mono">{{ (cfg.avatar_url or '/avatar/agent_immo') | e }}</span></li>
            </ul>
          </div>
        </details>
      </aside>
    </div>

    <footer>
      <div>¬© Betty Bots ‚Äî Spectra Media</div>
      <div class="r">Support : <a class="pill" href="mailto:support@spectramedia.ai">support@spectramedia.ai</a></div>
    </footer>
  </div>

  <!-- Protection : pas d‚Äôerreur JS blocking si des √©l√©ments manquent -->
  <script>
    (function(){
      try{
        // Accent l√©ger sur la couleur de marque
        document.documentElement.style.setProperty('--brand', "{{ (cfg.color or '#4F46E5')|e }}");
      }catch(e){}
    })();
  </script>
</body>
</html>
